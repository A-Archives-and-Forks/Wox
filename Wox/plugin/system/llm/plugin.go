package llm

import (
	"context"
	"encoding/json"
	"errors"
	"fmt"
	"github.com/samber/lo"
	"github.com/tidwall/gjson"
	"io"
	"strings"
	"wox/plugin"
	"wox/setting/definition"
	"wox/share"
	"wox/util"
)

var llmIcon = plugin.NewWoxImageBase64(`data:image/png;base64,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`)
var llmLoadingIcon = plugin.NewWoxImageBase64(`data:image/gif;base64,R0lGODlhKAAoAPcAAAEBAQYGBgcHBwsLCw0NDQ8PDxISEhUUFBcXFxoaGhwcHB8fHyIiIiQkJCYmJikpKSwsLC8vLzMzMzQ0NDY2Njg4ODw8PD85bkA5bkBAQEE6b0E7b0I7cEJCQkM8cUM9cUNDQ0U+cUU+ckU/c0ZGRkdAc0hCdUpEd0tFdktHeU1IeU1Je05Je09JeVBLfVFLe1JOf1NPf1RNfVVOfVVRgVZTgldVhFhSgFpXh1tWglxbiVxcXF5YhF5cil5di19fX2BfjGJdiGJijmRjkGVfiWZhi2ZmkmdnZ2lkjGlqlWpqamxmjmxsl21qkm5vmm9qkXBynHJtk3J0nXRvlXR2n3ZylnZ2dnZ5onhzl3l4eXl9pHt2mnt/pn2BqH55nH+EqoB9oICFqoGBgYJ+n4KHrYSKr4WAoYaMsIiEo4iOs4mJiYqRtIyIpoyTto2NjY2Vt4+LqY+Pro+XuZCQkJKau5OQrJScvZScvpeTrpegwJiWsZiYmJmiwpqatZulxJ2as52nxp6enp6ox5+qyaGho6GsyqKft6OlvqOvzKWlpaWwzqayz6ilu6i10aq306uovaurq6ysway51K6716+vr6+917CuwbC71bGvwLG/2bKysrPB27WyxLXD3ba1t7bE3bbF3re1xri4uLjH4Lm3ybrJ4ru4yby9zr3M5MDAwMDQ58G/zsLT6sTC0MTExMTV68bY7cjG0sjHx8nb8Mve8szL1szMzc7h9M7h9c/i9dDO2dDQ0NDk99HQ2tLR2tLm+NPT09To+tbV3dbr/NfX19fs/tjt/tnu/9rZ4Nra29zb497d4t7e3uHg5eHh4uPj5eXl5+jn6erp6+zs7e/v7/Hx8fLy8gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/idHSUYgcmVzaXplZCBvbiBodHRwczovL2V6Z2lmLmNvbS9yZXNpemUAIfkECQ4AlwAsAAAAACgAKAAACP8ALwkcSLCgwYMIEybMokkWsWS2PKnJoLAiQjGyqFmjxpFaNWvE5lgcKZBQtGrLMG3hwSOKIV8cPR358QMCyYOJqE17dINJnkqbBml5UedZtWk6k7lyY+GmQDHSptXJISnYsavHhpViUkXZs2XPpFWjtkvMzQq2qjHioQqr22OlXrxAQbfIH2HVogUaeUQTNWQzKr29motPDSeIVM1i1YjKjEc6RSb84UmatWqGpFh1G0ySECGONmMdJqnGH2rOdlxMZg1aqDEtCrkthopKDD63BmMdFcOUNU8EDFoxGosIkDYmRmGd1cZFmVfGdGM1JohItGgkCu4gVs2UjDy5eKH/aHuVTJNRw97SGiX66i0eraq5AUAwUTVdMxAVO/ZrPFYufrz1yyI6rCBFKftdZUwYelgDCX0CkcDMNF6kkR5//l3FBSCjgQKFDYOosoYLa8AS3TF5jGFNKhBeIoY1vbzwClb9kXfMhscY80oZJJqYVSlS1ABILiiqyOJAlFiDiRQXYmjjhrfwEQMHYRDJWSNAGFEJFw0+OJAm1dSxhls1/icFEEJI0kgPRmTSpHt2yFDCKtYQ0qIn1cDRBpkZ3hiDH1bSYocLXKhyooKlBFHHNM+oJpAm1jDCRYIYgnIiF3kcmuMaJ8AgBy1vodKbNZQEINAc1rRiA6hXBaMFDYDe/8jhW3KcsQkTPCDyy3R+ICGNMxEItMN1RMiGVWdADCHJFbO6JceYvCBSgxaHzkJDLdRYMVAq1oRCg42E5UGDCHZoWswZY15VSQ6UFuMEJtbsAaES0EwDhw6jUHrVji60MYsxxsByhgnpHvMJu251YYg1ibQIKSYqvCDHLG8NA4oTNQgiJRVSFHwwpcZcwUidLaZSjRlvfOIEDoXs6tYtWmwARFXPYvUxVrwAsYp8Lab1hCL8IaJDE5ukR9sVNOSR2zE1X3Wz0y8sMw0JPVcTBSJY0UKHC2GM8oZz0GHVtMEI8ycFHtXYEtxAolTDRsHHFKMKFyo4Acqbx7zhMcLBvP9BxDLUiNHiJZBYYwoQVo6miss0LpJDHlhtksMwr4TBgy4rIjC4EtNAE8Qgmg5mMRM2tIyVIypwEYMXwlgDTAaDC8StKTGAIp0xrJDxwhsUu/UGD3jUMk01slB90HDUGELDIoznKGgMWqii7zG5ABHKZczswUDsBO2BFCc5JOHHKKhkIgcPWuKdIx9EQCONGhEAwH1Be0BjzTKPVDFDCznkYMOMgzGGJGRAJ08IYH4HUUJGNjKNaExjGVVowidEYwxa5EEGmKgGM4x3kwYogRK7eEY0jAKNP7zACXZYRCHKwAMkxAcaSkBgRQJQAAQogAGJGB4yHmGGKmChDquwTDIuYihDp4hhFxqxhhIvAw1KdEB+TqlIApSQiFTsQhaemIMFAlDEKBJEfmCE4kgCAgAh+QQJDgCXACwAAAAAKAAoAAAI/wAvCRxIsKDBgwgTKhy4I5AnW7tsiZpDYqFFgyASMatmjZrHatWcebqY8MgeSp40QbJVbVqtP1ueYNFTi1o1W0dIElSSKhpHkNasCfMig4ugRoLCvNjiq1oyJTov7XlmLVorQ3DqMDKVg8yrYsfCFpt1Jkcsa7IskAxEbZopIjW4yGnThAOdYGHzhg2WhweyaoEuzpkmDU+NQbeMHTMWRssvvZCDcUFDDRiIhSSSUTMEBJVeVShYQR6N6oWwm2IU7rEWa8Yovca4nFG8+JWqUqAySWqEyE+MP9KqURNV8eAuamjK0A5bCgWsvKBSuIhRAwcQI0ygGInB41FwWTsM7v+I9kxGKb3FpMjJO2wKHVq4eP0KNmxYsWG0HAGJ8leUwSzU+CIDLXp90sIseWUy4GiQ3cLFEs1Qs0dBalRTSw28sMdEHnkFY4QfDI7GCxRwUENMcQJZEaALBIa1iQotHiNJDLkYc98wwfzCyy25QFZaUxMOVGEzL3ySFysxSLJXEDx0oYUUTBgBBA41xKCDaOxRYYg1mgx0hGaMhEAGWIsBAgSBi9zwhh1++FFUJZuAUooWXOCVlx9eUCPLQJ5Ys8oNdrgASl68MNFGLjk0kpcxg+CAYFis0OCIXo0sQc0uBlyywzPSIMHHMHIwkWFYo8igRRF2hvWLE2uQyagOjx7/g8gU1NhSgFTWtJIDgrQAkQdtxbyhgZKQlXLCJnmtmgZYxpxRRzWpBHCJJtYYogWZlcSgSl69/gpZJRwY0SNzLiBLiw6mWDMHAJekUg0bdLAXBhWpVgLDth0KIYcQdgBLhxG35IGENNAU5y68esFiwyLyUvGLjcM0kgMvCuJ7zC1AUHFDK9ZQwu601XKxnDGI1ACIH3nIQYUIUlDhRBMqIHLMMGRI8VhYiHyAiYkkfExINa3UEOMxwZwBxRVdkLGGHGwWIkUQN8NSg6JhzeJCL9WI8fElR0ATTRF+LLdYMcaIfQwvN0wa1i0yVJJvuqkR1KcpMbwWol5+GJFqHk0M/8NeE6FYo0ZBm26WQyZmQ0ZL29y+gCyhOMRSTRYGqTHNNI+0wEUlr9AyCyy2oTLKJ2cw4XdYdEhxeliotLCMNCgORMAc0ViDDB43mOACC7y7AAMNNgBh9zGwoDD8YmeYYSICBw1gBTFBxdJCJaq8AsssPPISzHJrXLvoJi/UYs0eWxcEgAJqeE1EIXdDioJnYmWSwyPVEBPBQgFQywkPz4XIyxVaoM8vULGGFzBiGtGwQvkQ0jVpjIEJ/YMML85gghcIoQk4eMEYalGNaKhBWhfZAzWgMQYdOOIWZDPGLzbBBCToQhemCEUrlGETYlgBhBdJACWqIQ1M5IAHVygDF1t6MAM9NMMaHEHiNICxhwgs0CIJCIQ0qtIKRvzBEKZYRktEcQQxqMEKJEAAAJ54kQAcIRXQCIoapSGLLBhgjHAko04AEIAMiCEQkCCEGkhAgDFGhSRxjOMfLxEQACH5BAkOAJcALAAAAAAoACgAAAj/AC8JHEiwoMGDCBMmVEPJ1S5bovb8UEgRIYQ5yahZq0aNWjVr0CjtqEjy0g5RHYUxGhMFC55W0qwRgyQqVSpIWUoWJCHL2rI6LajkUSSoTI0nsT5WW2qN2i43OgVqqqbsiRNUw45pNTaLzoxHjNiMqcNJGUdRIEqKmRZtShheWuNqZaVDBRU6fNYYmfEHmjVRJUVVeySEllytwxS1IMMqq9Zgm5pEWVYNsMIfhKRFC7Lo8LFZWmJUKub5GC0tWKZNE5NwTzKOq2IYjmtMUgwus0rHvRXk0V+EgaZVi+UFxRDHx26daaEI+bFipA83CgIt2siCgahJ0yPjzRomjnkJ/6ny6jAsLmFKOacVo1Y1NQWVQKOGB0ipYo6MBNOai8YoufjJwAUZL2jRyX7HDMMEJ9YQUpAn1phyAypabYLDL4/5UElctITxQiPQqbJGDFJU8ksxVPiWCEE7PCPNEn4YoxUqMtyCWBKKHGNMJjlQAQuAr8hRQxKODBGKNYEQtEc1tciQm1avsPCjjlT4wcsaJpSwxivR0TZLHjSI0Io1shAEiTWYOIEcLS+oslUZUgDRBCqbUAHDGap0udUrUkQBTTUrCnTmH2HIyF8N/2klxwh5IDgMKE2YkJ5zx+TCBBzUMEOCQIlYY4gWhh4TDBAbauWHFHoek4cRYbigxScIav+ligq6VLOHQG5ECASGiDERBiwyLtIEpYU4EYyIMEgx23Nh4GFNKgL9QI0yM5Qi1ydM0PDGK5L0EKtWkgixXzGquACKXI0gMQ0xAiWwSzVwXOFcMJlQ4UITMdgo1yI2wCUqqXKNcgM0zmRwCQBuVLNMDo0eNswoWqDQxShZBeOHCSzMpmCOcY2SQzTOWCAQArZYE4sMZ8wSKmKotEqFI1PoMIiUWhVzBR/7LrFuBAIBQAI00xARgw15qHwYuTxwcEYutLjgpo5lvBHXMFz88dtAEjzzjAyfSJIEDXK8EipoN1QiIy81nKsVHWQYWsoLvVQD1UAdRNPMC6yIWokUMrT/ocowtnGx7KiSxOUHFaTBYgQe1RAjAUEROAPNDYmK+skV937o3C9CcHyMIk0EgwoTXkSzWkEF2ELNFnk4XAodU8YFCxU5PH2MIzR0MUMdf0KSQEEAnImJELnoFlcxjbwQxrLHCIICHO5RA0kDB+0QTTRI2EGpXB3K4IiexXShx1LEqGEAQgKIYo0uM/Dxbc2Z1HBF7HG90l41gUAAgEIWEGNNKzm4widyMYxh/GIUYVBBIbYXjDB4YRrMmMD+FAKAHSTDGsqoww1swAQn1MUDnfHML96QA2TYqiQ+c4VHmtEKTmBiFcioQwwAMYthGKMYvAAFFIrgCzJBQCcAUIAYZWQhjY9sxBrTMAUSZOCEMGihBy/AwzKsAYxNRQUAACAACLLghjmIwQ3OsIY0aoEJQzBiFZShRioqMMGoHAyLcPQZJZxhRGsg0RZiQIAbKYLFCFhhD4kIhBhIYIA27pGCccRiSQICACH5BAkOANcALAAAAAAoACgAAAj/AK8JHEiwYEEFECQYXMiwIUEJalLtSsZsV6o5JBxqZKhmFzVr06JNm2atWrI5Gzdm2AEikbRqyBhhCZIjyh9f1KiJ6pDSoBhIu55Bg1ZNmqEXVARl+oRIy4s6REX1HKgkFUlq0ZY1g4YGSKZgx8IeG4aKSZVm1QJNzZLMGjRMU168mHEDyCuxeI/dgoJmmrMjKa0wqxYLiRA/pVgVQvEpb95XNFZZk+WGZ8MJtqqtmmEnV1hja7gMcyzW2K8zW6ZVqwbMTcM5MHP4GR12Fo1OYoPNQlVJ0BstQl6UMEFEj69q0xItXLCrGhwtYMUKMhLdWJsRLIBoaQNIUmJUjbTI/zAkjRohgzumNZMBCi8vIYXEzopx6Vcx0mM/9WAjTZqYgmJU0woPvOB1SQ20iAVIE9HhFxYrOjBSjS0EAbCHNZhIQdtYV7xhTFjvIeJgXpXIgEw1WQwEQCAYSvFhWKq4oIpYlSA4Vi6vjNIIH2e88QtewTDBiDWaqKiGNa3o0KAgOHg2FhU8hMFEDSaUQEMTYcjBQx4vhuXHFtZQSBVML6AiHxB23KeKCmHksYgkPLwRzIubxJAJXpkEQU0yAzWQijWrlFDGhp+8UAloWmxYCQyNfZaHDrDQGMQ0xAxkBTXL8ECGC5WIVYwfNmxCw52e2gHELGL9csUVPx4jCBbU7P8iUACiWGOIE78AUsNdYQXThQpCtCrWLTZw0SAsOuRRzDBUGEKkQBAwIw0RjRzjqxTCzhJEGPfhBcoLLvDRZSYwbPKtMNSoIRAJ1CDTQqTHzAIEHd0eU+gleBUTRhmXxICbozoAoQdrFgh0BDW11HCLWKDI0GlYxQBiA6/HvOJCKcbQcapY7y0hkmsC/VCNMCo4eYwxoN41DC+sDMEEIL/x4ARYv1DBhbCFLEENMwRVIM0zKpiZKhdCSKGDCiVkp8UbdJhQbVigqECxKi08M80OAxngERZ2dBlvHohkogotc4bViA5OGmPHzGLRggIy1PwnEACEALrriLkxkcewODj/ghcsLyAjDWBzg2C1GVAkiPcoLlB8tsnHdHJDNNBkpOIe1DRTRROlbFjaMDhywW2veuMFGhrUiKniAZpUAw0eL1xRSCWZLGKHlFSWkIPQx4wiA8XHqCJDLNWcVxAADECSky9/LLFBDlOU4eYnrNzSoDFhkFHvLE3AQY0zWBsEAAFiAFONNc3M8LCDrLgwCsSjDOEFNNTs0RAAyFth/h9MFIjfMGSogSM2MQgqyOAP0ahGkTSCPyVQ4xlIOIOw8DIMP8ggCjSxCbqoAQkKpAQABaiVMIhwBVVsyBivOMMNWoEV1ZQEGGJQwFQAIAFbWGMZbEAK2PzQhRpgwRfWeAYwTpKxC0pkIQJTUZEFUpGTXjBiDFjwwh9qoRpb7AABCAgAAJJ4vATMIRkfqUZOVsOMQBSMi/fLHyRSYQtXUEINFNgiGhmIvwAEYABaRGNAAAAh+QQJDgDXACwAAAEAKAAnAAAI/wCvCRxIkCAJNYEC7TlSsKHDhw3VuIJWzZpFacAIgbj2gAQJiCAJWqA0zVq0XqZCtVpWrRqwVMSePUvmas7HkA0tyKoW7VEQF0Ka6HgxRlfLadCeTavojBBOggtSWUM2RciiWcGG5UJ1ZoahOkVm3CBSpxY1aqk24gQwp9oyImFoHZtLl5YRFGEcoUIlKcwLNs+siXr6wBk1NFJ+0aXLikkSVMUWG1Pl5Ekzak5BAlBjzVcKVouPGftkg8yt0HRvSUEz7RlDiCRsWfvTJfSwQTHyBEO9+FWMVtYyN0Qwx5nJJYgW81oTQ9IwusYUhzb2Zgw1Ww4REKI2zdSSD5Xozv+iIgSVMbrDFtkI82k33VE3knYoKGAOtWhwbuSxIYkuIhuwLPaLHDQA0oYMPOTxynmwsIDMNDsUtINScAjByjBU+EHXJjzwUpcWPZRyHi+SUGFCFY2g8oIw0yhBEACeWBNKDqrM9UYZ5x3zCgsBHqOKEVL0CB0sfgSBAgosUUIQBM9QQ4QgOSLCxHPH5FLDJ8VUEsMGa7ASGWrBSKLDGNBQE4hAAChBjS4vyDXXJzXkMtcwTADCRwx+lGgCFI2chhosTbDRmotsWYOJE+7pyMIrdJXBQg2ZRGYMLFdwoMIZoyQ6Fys0nGKNJtcAEIg1jHCR4zG82NAJXX7UUONiiBj/8ckZKgThh5+i5VHFNMlMAMAehkrx5TF0FkJXJjhIRxcocVbZCA+DLMbKCw9aAUAW1cRig5xzGXPGFKM8xwqPocHyAqNzrZGGgDa0Us0cAFgQzTM5XNLbGS3YWkoMo0hWSgqb0FWIE1QeEwwQq7wLgACuVGOIEbiEdksjVZTAAR0eHlOMJDWYYOxcm9iQcZU8xFKNG6EqgdQTYYwM3St58PBCG6Xw4UIhZKxB147o+qjCMtIQOgAl1QhDBBTm8RbMJ1RsYEMmxggCBZVWfjJXMXKMUQ0xAwEAgSzW1PKBCVRI4vJcrySRBGjHhJzxMEkkdwx8JnvyohXVtIIDKjHL/9AGKs8Zs4kOce1MrmhlvGEMKkH8QU0yEXaNdyzJGvxJGCggMQggL+i2mCos9DsXH07kEQMe00wzR0EA7DCNMC/MshgtiDRRgyPDGlOKDlxwewwgISyxCnfCdf0AM9IQ0QhqxdxyanoxyKHsMXR4IY01zuzxUACikGqE77z9QocLixRMbBOYWCPLaw6l2RoSb5g/Oxc6gHLqXKO0gMzJmhHgSTW6uMEZcHW1UggBCkJKTRLwsLW1WGAXnXmCDewwClao4hKYuwL45kILLURBKdpbCwhsUQ1phMILM3jBC4JQBzTcwA9YKcYwaNEIIFSBJal4CpoiAInr3WcZQKsGNVtMgQQZGIEKTKABDx4RjWq44iY6BAAASECIXTgjGtGgiXGmoYtQPIITtYiGNaahifno8EULi0AGMuAAAZAAEsyghkWsUQ1opEINZ4yi144whz3MQQxQzKMgBRkQACH5BAkOANcALAAAAAAoACgAAAj/AK8JHEiwoMGDCBMqvAagghhKrmzJ0rSHxMKLBQE42MOsmrVq1DxWc0bIIsaFAEjsqjZNl6ExVcYY6hVS1pGTBgEs2KHESjJryMa8uMKnUJ4rL8wIswbsJs5rAUgQAiYtpDVdOcKoKnas6zBWXHjospbqqYE9zqxRW1Yr1qocdoZ1ndv1Fx0ey6gF2oFRgSeWq7C8oFFjhJZgdBP/olKnWjVoqbIoJJCoWjQ0cFXdGqVCVeK5w2ihSoOCUSxo1qZp4pszyzRoWKq8MtY1jxS5Xm+hWrQmSYwYTaQwocGDUTRrrkwOBJBg5R8jtOYGM1JoLiwnNFwYOVOoFK1gxobd/2okpAoya54yHqGGTMYnuqhcvJrrxwioWeA/d73F5UmzansQBEAi1jzCBGJz2YZbME1Up19iuTCBRzXACJhKNWPkQVcwQyAylyryfVYML7jNVcoMwlAjxkAC7ELNE4vA5wIs9DkhlzG/vFJJHlrwQEaJxwTDxCPWQMKiLdRE4eFcdlCxoBFtZMIHFziwoIMWfEjCgxxczSUHG9WUJRAAolTDRhu0HVOMFGSkqUoJJ9hAxRsqvMFLl6rIAAhdgmxBjSzL7WFNKEDk8uELhdDGRxOq3HlMJihkQhcoKjiS4BjVuLLcHNYIY0Kic3WCwiUMDpIYIi2gQpckKYCiphaGWP9DyZgRJEMNGjy8oOpcjajgxwvzbSjEDcF2JcgLqrwSQy3VzDFmFtXooisdOdDYlTF+cMAEkMew8gIURUTXVTFy8MDFFtMw08GYmljzBxfFDFMGErfMVcwbPMySmCBJ5KLFFLxIdwUKvRR5JDVYCFIXFVL8Il0XTRjaVTBO+HFMLk10geAxpbQgTDUrMkQAMNMgIclctzQRRom8MKHFbms0cQIrXc2ig4ZeOYGJwQINAMyLMc41y5a3qNLIG0Jw4MIQZzBxoFdU2EHXl9WIstyFbLyRWJ4wvCBEGIOMgh/FFncFiwu7dsUHppqOKagpOuCy9X35zcUKCzR3hcgQDnv/CaaYDJEQDTRE8JHmg3MBkgSCw0RN1zBOEGnkQAN4Yk0rM0hyuH7GRFj2MbDoCt8LKYY8JgjMUINJC3zccjiOsGzChxY6yJD3MYgYsfFicFBDjAUZKQFNNa0gwcMahSzCRxdAvGDDFXZcYu0xjUs98RpBKAPgQQFYwYw10axSBxIcOEGHJI12SdcruhoTDChSELEU4DmBoMlxjxEByOaJDbPGCWcgwxBeUIdmWMMWTknIAEgwh10M6gZp+0wlCFiHP4RCe9RoG0ZS4gxq/IEHleBWMBTxAk54xBqp2YWzngIANUxjGox4ARcu8YpZsGIRTriBKaghDVFAghBWgMBTRAYSADdEoxrCwEMQXsDEJRhiGeBb4RANMgAlAMMx0liGMJYxDbW4Qg1TVMgD1JAKZkhjGtJIhiikGMaFWKAnO5jAFAMCACH5BAkOANcALAAAAQAoACYAAAj/AK8JHEhwIAAAAwwMAFCwocOHBQEEsKBGlC1gtkTN2SFxAYmPECCKFAigQSBm1axVm0atWjVnlGQ9kzZNGjNRYkY6BEDCVjVpsf5EWRKlTitp1qxNWyZs2bRq1Gzl1EmyAzBrwrzUKIPIEaIyNaaYwsMDhYwXRf4oqwbNDVUACFxZq3WDzKtix/IaY6XDRJdMsGCxaiTlRihq0aaKBCCGmjIedoLlnfzrDI9MwybnDYZIBqZqyX4sRrCrGpwrkjXzChNElWbNxiTNqGUN0uId05DJKPU6Fxchr16/HtZmy7RkJB4enGPNlJDUeWldaQJLNfTJrGT4oua2IYAFe6JZ//sTxthkWlKYzNKsSoiQN5tu4T0WjAkna4S8J9C0EtONMuYdk4sTUNCiGSo8nIEIFzXQwAUirwTThSHWJBJRAIRU84wXPEhBRYC0mICKZqXwsMYvxxRzyyd0GPFCEzlQyIwVBAFwhDTReAEFLKDEgGKKRjSiFyg2yHHdZqwUMgQPrVQzI0kDpFINI0CsdwsKruUlxxl5beKCEKgcqVoeM6xijSwUXMOTNNDk4IheTCAyWSU8BFOJDFwYwYIRdHyCy3yaFQPIDchQs4eaYlizCg65TJZHF5PNYkIeMQAyTDCsIBKECDV0sQgs1wWjRR3V7KJmItYYwkWAx3wSQ2rFFP9hwiCZTSaIEZu8IYQLTFQ32Sc5NCMNR5RYU8camt1iQpbHvKEFoHmhogIv9LFihJyT5WJDLNaoAQAk44UBWxPYHlOJDrVOxssLvOX1aKBGhFIhAG5YE8pzmtkRhB+o/DJLCb5iV+mvNEA3TBPyBnLNDtQsw65mtPjBxAtAnIHCIoCysisVk13JSrY1xFKNGtcUsIuxUPw42TCwOBKGDS5cMYgqqOhwRiYsUHuMMeROtskNz0Szg5pZVLMMEW2oDFsuo+TBhAopnMiLCiPmZYe49FGBRzW2DJSAlL7woAUq6b5mzCYsGJkXFYL4XEMww/iRAzLVzEFQT9YgEwQKUgj/osp1xnRSAx3Q+aHFeSaMYscMrZzZUAbEUONFGU6/8F4mtAyTSQx5pFtMHnVuBoQLSNQC2hENBSBKNWPkccwwryzyMg1SuOBHusMAEoMkAQYzBB7PVEMMjd6Bq2q6xuTyiR2L4M5HDJWwygsOjacy9E6N1VJDcMJpNowdMWzC6jGovKDMNEqIVAEz0niRRtmvBfNGDaO8VswaXlBDTAQiYViNLzMQBPzywos16KBdmgGFDERmoZFUABjVWMUM1gALQBkDFVTQQdU0M4oYgUY0OjkCSnSBhRhwwQ+F4IMUWjADIVziFsOI4SvkIAND1KQ7VDkCBKcRFC9MAQ2MEEYzTwyRgxo4gQpCQMEUWkGNaRyKKgPZASWckRKoVJEa1oBGLDjxCFMUyhrMwCEUo7gHT8jijKLYgxpcEY2UJAU0iQDhGKG4gzkkghCEIJlOAgIAIfkECQ4AlwAsAQAAACYAKAAACP8ALwkcSLDgJQAIEwIwyLAhQ4QDSKiBpAnSniMJFjrcWBBAgCOupFmzVm0ktV1qGnBcCUBBImnVmq36U0ePKWTUqKUCsfIhwgSeqkVjdENHmDZnmryAs8zarh09ByJcsEOMpphbgEjiZeyYsWGjrhDRZS1VRo0OEVoIRIzaSGljpMw6RrfusV9tgiCrBsyTmAhoOwbIkswaNWGnMNXRMdeu3WBa0MA0TExNAoYB1EyjFmvLCyBMOCByTNcYL1R+moTggYWRr5yaKnS0Im2aIRlvWAUD9eKW3WGzJJ3R4QJKHkmVCmmZgQdaNVESpEogVs1Qjk9dj/nRUveXICgudJz/kTRr2O9SSaI0qwZJ6p5qtV5sqmuMiqC6n1rwQcWVdF1aVIwxTTRWCIQAMNSYsYZ5dPGiAip12RGGf/7BYoMp1lAiEAnTIDMDhHWV0sIvpTUxml3G/KJKJwzWxUcU0yQjAQBWWBOLDbzYBQgVdd1igip0FUNLJm8IwQILeQRjlyovKDNNgWJUY4oRLR5DBSD40YALK8rFYEMYjcCySQ10KElXLjXUUo0al2RRzSo9mHkMLy+UUlceLRjBwhBC2KBKdseMUsMbZvKCQyzWsPnDYS/AUhcsLwhinjFTOIGIbrNAAUVjdKHCwxkkziKDL9NkcUkEzEiDxCD0SfKCH8Pc/4ICkP9JwQSnx6gCRBm8ZHJDNM+QcEkAnliDCQ+OlpZJDHlsIoOcdNGighHJ0sWKEGFAgYc1rgiUgCzU6PEBFb6VNiYPXJD2SglQCPGKXazooMJebAJwRIc3INIEuXZ9QkMY0B7TyBC5kAEErXRt8oIwax60hzWcNPHLLE5IQYtdpdTQhpzDlCHHXWcEgfAwVBhijSgHaWJNHWt0RYsUTuCKini3qFLIFSZkQlcwXXBXFyJRUAPMsKlUg4Yd/1HBRLJC5iGCDS8kEcYInHaRR785ROMMYKJYA8cbduWixRCfIKIFDTWEscgrwTgiRDE7x/AJxjNI40x0hBjrRJW8hP/BghF0fHIL3HSdATZdqqBQLl2NLCFNMgtcYgWjINYVDCwBHzNMEJX8zASgx5ABRzWpCDQdNWxokbl/r5jAaRhI18XKC7VYs8dAgVSjTBBvkOifaaXk0cTbO9Mw95lXoDENMz8QJIs1ugShBSqEaw6LI2TwAIN971prwsXHzMIFEstQQ0hBPwBjjTJoqOAEHXy84YQLPaxRSXmOCWIELar4wcMWyiiLBQzyA1dU4zCYgMMSTJAHVPwCdHXJxRBMQIMXRCEUInGFsBhCAraUxBrN4AEfqueYYtghCLGohZOsEQ1I8IQje9CE+lrxgkFUaWeAmAGiqCENYlBCCVERiBJhkvGmG2hhFMEYRjF4AYor5GAV1UiGGHYQgSASJAvMqIYw2NCCGjghCTaYQR32wowCWdEgSrAFSZ4RC0xwohXroYYsgHhGhkhgDragxgerIQ1b3K6OHLHCHvaQiDkcwYoBAQAh+QQJDgDXACwAAAEAKAAmAAAI/wCvCRxIUCCAgwgBGEx4sKDDhwQPJiBhRU2WHRACAFiwQ4wbMUcgNIRI8hoACXuATatmrRo1ZpQSJVvZkpozTTsClHwYwAoxl8pimVrlS5o1a9OEreJkqqg1aIEQ7CQ4QM3KWl5e2BgC5MUSTKuqvPCRRIgLJJhWpmow1aQVadMYyViDitewYLD8fHBh51Wwu7MG6fACrRqkAlMtMKNmqManYcciHxt2BggqY5Ilz5KCBRo1KzsBBKpW68WmzMeM2akBC3VmWkMMVZOloGQDYtS2yMEs2RiiF6hco840Y9m0IyWPUEP2QhXqSihOa54VjHfkX0M4WQtEEoAYa6aA/P/KXErFosyqYrAQEkbQKFrV19SxpkmhQwAkbFnD5KSY5Fc38GHdLDzIoYojbzhBgwtGnEHFGNVIM4cABQGwQzLWCBNFE5BN5gQZHR5zixFhhDjMLagocoYOL3BCTTV7UDiQBLtY00oORsRAS2TGnFEGb79QIcV4whmTCyIy6EGNNFbYB0Ai1egygx+z1JCJZJXYcMtkZESXS4jCscKDIdQQE4FAIEAzTRVrDGMMGWfwdksNmxhDxwtAsGCDFHJIwgov/qG2yQu+VOOGQG7YSMMskWW5ZWpllCFIc8HM0okcH9CgFRV2gGJdMWHUMdsB14hSDR4/RkaLlViagMInmeX/YsMisGTCBxU07ChZJjlE4wwJ19hCTRSI9FZGnJHdQgMfrq0RBm+54HBJZrC8gMw0oBEzDRKSZJaJDbjwCKd1kXWSK4/OBnoMLS74Qo0Y1+wybLGSrXoJb5nU8Khko4zQbWSfnBvZKy1cq0Spp5JhXY81cOHHJqWwqhkPLzwbWbT/HiNJENL8ek0g1sRCQ2uS3XKJHVLYwMIHTQACyiyzGEFGJjqiG4Z/wVDxRzWuCLTDM9NscQaYkRWTiyqSyAFFDS/EMGQuOmQMSq7GNHKDMNXMMRAl1vgyAx9EozYMLUwYsaUxzvLGiw6OSBKDdrZQMFB+1tRyQxiohM0jHTkw/wpwzamdUUMMj1TzTBYFqcFMNchgUQITbzSiypc8DtJcZoi0QPIxgNxQSzXQaO2QEsSAxwMgYQihlRR0XIJICrBKtgkKlWRWSBXUPAMaRG5UE0sNuRiD1yd+cJFnI5mh8gK9ksnBRjWplLSDNM3MMApqxvxCi3Ww5GAHub80gYk1kOwkLBslClevEEMPV9w0iJe0RzXC3NAIuZnxAsUVwaAGiw+MsIYspkICYFSDEy2QRP/8d4Um5CIzxmCFEcYQDWqIbidWeEY1TDEDLWyCFr/gBSv8YIMSUCETs+AFiuRwAzgUJhFtEcgeoJGhOtwgBjqwwQueEApf2NAFNojBC1C8sIqVUOJMMbyGGGxRDcPpohWxuNZRQOeLWOiiGdSwhjO4k8SBVGAPsohGE6sxjWRQghCueMaLyEiMRCCniw4hgUfmoAS5CYQiYhADRqYSEAAh+QQJDgCXACwBAAAAJgAoAAAI/wAvCRxIsCCAgwgPFlzIsKFAAAU6qEmkCdKcHQcUOtxYcMCRVNKsiRRJbZeYjBxTNiAkrVqzVYbw/AmFrBq1VBUApHTYgBK1aI944OiyhswQGXWWWdtlAeHOhwACBKr2bEwRR7mMHTMWbBSVIL6q2dpjpUIAjQ4F7NgjSpq0MU5gHZtL99ivNkSQiawGTdSPsw0BkBAVrZpNTDrk1q1LywgWRphiQbMmjdACnQUJiJkMzRSbKigQLZ5bjFUeHi+caHFCg8ejwqIuF3QzjZopHkDalHExa/GtRlVMUJF0a5ixYb99bFlWDdIAgkqgTTMkY1DWQkyGkR51RkUQP7C0jv+mRWVKtGlWMF+SVY1TjVF015yhy+pEmVHaRzM28seareeXuEHNMjc0It4wUAhCVyU6/KJfMOLRtUkLz1Czg06aWMMIE8HQxYsNm9DlhxTF1NXVGTwskt9cwQhhSjVz6AQMNVUoSBcsLLwylzFkvLEjLH4E0cIZfsQgh4M7noGHNZoAEIEz0eTwSV2g1JDLXMM0gQgvklAxQhWNXGlMKT1w0dtcdrBRjSgAgPBMNDOUUhci2c2FCw1MyMBDGCnw0eGNUhihylxr1MHkJQ8kIw0PmdT1BhclHsOKCWF8AmEmNpBxS125nFFDJcEwgYk1gQjEHhp01FWIC4holwkOvNT/pcoQTuhIVzB+yLDGC8JQY4VAGa5yw6akNUJDG78IAkWkdBXygQ2fRFiMJChsQU0yCwhkhTTTLJHGimMCccUVa4z2qB0ytEqXMYDkUOERmCVDzRgi5PHnXLBQwQEfixVDhR/FNBIDsrcaMWqTl2RBjTAv+MEDGVd6uEYMlTD7Cw6VbFWKDm3UNUgV1QBzwCWJWMNJE8Gw0kStdQ0jSAz20oJIEyMMutUZa0QIyg3QPPPAJRn+UYZWtHShQ7TrSmKCESkgEUYMxA7jRCGyvtBMNBYAbQ0eadD1ix2sDlNaHjnI8AYqwyxixJ8fhkjXKDw/IwHJGmqxYsA0kAHacLHO/0VHGOLB8oKtcwkSBTXAIHDJHtXEIkPfO5byb3h1GaNFHnR9YkPEdhnxiDWUCHTEeUEUEuGO+v0ChCR00ZmfMYPw0Mw0agwkijWh1GCzfnP95kQKu79xhlbGSCKDKdbIAp10dQSByuksctcCEODRNYwUgAwDyxsvYELNM78SFAg10uAhgxyq8BJMLqwEOWQpK85FiwtQUCFDFLFUI40bDCVSWyteeIENgGADE0ghTLwrxAzqwIhaTMMazBCDQ+bADGsMKBaraN6Z9MOKGnCiGhZkBiRIwJEfQIIY0wAhNLYghQ3KyghsmEY0EuEGEj7lAUpQgyhc4gUdIGIWYtMeH0toAIdoUKNUT2HIDqWBCSLIwAhQOEoUTFEbSCTRIZCIBmV0EQpMmMIXIYHGHq64ESuk4hkgtIZhmEGJ8JFxIztQQyAgsYc5ZCCJAQEAIfkECQ4AlwAsAAABACgAJgAACP8ALwkcSLCgQQACBBgIAACAwYcQByaAAKIDAwEAIojRJIvYrlR7SDCMSPLSjkS7oEWLxixVomTVrFGjNq1atWieSDQsWXAHpWgyoSFbJi0mNV1/qiCJwsYUNGvMrOzkeenIrpuhvMyY0YIHnFVoXmgRJGnRGyBEVlWDJpXqDmDWfEXRkWcUq1eVpHygomrYsb/HbvGZgakaM508PVXzleMMLcCBm4ThBRmwsUoyVlnTJKCkmmnQkLQJBnnYmSa3KkM2xgfJSsQRRVV7ZATXakQ0VKmufIuHKWtzHEZ0No0IosqoYiyyDEpSKVi8/B4ztqZOtVQLhBvMUg0ZilmQaTX/WSP9WKkYQGSUQMHDyZk8XZ5Qq+YKdsE91mLRIP032JkkuQBGixFtDBMMLapsgogdYQihAhvIWEOMfQOlkh8PvwDWSAy69UcGEwHu9kspWvAQizW7SKDdJYpBg0YK4P2VRxP8GVMIDazsBlkwedzQSzWEaLcHNc9g0QQNkgD2igul/FWKClp8wsotwRij4zBrRCHNMyA4tAMz1MDBBC1yUCFdMWGUYQwtQjDBRA0mlECDZHQgskmIf81Sg2bBXRJIfhweo8oLqAAGCgyqkOFEgMPkUoYQi/BxhhQxvGHlX9SxcZ1DrlTDhprHDKPFGpcGw4QRNeQIGCovqHpMJTU8/waYI0tMA8wBlxCXQyaAZUJDjMcswoEjlQ0jBR2X8iJEIZB9koM0ySiwQzTPmPAKYL8MIQhgt9iQZGWLxAoYIE1k+FclQVCTzAA/QLNMq5AVIoS5x9AhRXnH/KKFB8flGUMnmNJhhjWyAGCBM9Hk8El4NCxCS5WsuFDoX8XkgcN/NZ7RhV+56BCKNYE4ZAs1Zshx6XR2pDDCC0VoocIVlaAySyUubAJLDAs72WrFSEAjDQkCJWLNKjUAe0wxvMBSiiSAtHEFEC2MMEIexhRzRhjF/DUMFHYs8kIrmxEgULvTbMEFvTquyYQW5pbiwrV/LXLCC6FUkwzQAyXSHRFhGP+tWsU8ANttv8egkoJazlhhkCzWIFNFEHyoEp1qm7ywCWDF2BEEsLOkgAw1Sjy0gyzVSINJCSWooIMUZ/DhyCil6MBH1ue+kPNfsKDQDDUVQEQCJNNIwwMiqmSCCB1hNBFDCVzwd8wrPPhB+1+S8DCNMwqQRLoZdFRmTDC30PsLFc2XpgUe1qSyokGEWGOKDqnpeLQdQPhdyQzCVCPG+gUpsdISb8BXZWgGCuTwgBHVAIYEeKIJa9RiBn5wnmU2IQM7SMcYuUBEDfAQvCy4hRjVaMUNuICKKn3vFXJ4gQwuBgg/pEEHPOAETfZAFYEogRndgUMLenAFLjThBVWIxTNTTFGHLWyhDqZ4hjWiEYgaDkQJpKPGMkzBCEZwwhfTkIk1tjgfa0wjFR504kAoEIhdUGOLXGRGIpQQCFG4whWpIEToxPgQK8whEZ4ghBgyQMeBBAQAIfkECQ4AlwAsAQAAACcAKAAACP8ALwkcSLCgwYMIEyLMAimVLFea1FgQoLDiQTW2qFmrRq3axmeJLACwaLGDp2nVlGFis2XMn1jSqhE7MpJkwlTVov2ZYUTOID5hajypVc2ZGCs/IlC0OZCStWdYhmwKdqyqMVh0ZHCqxpUaM09HCtSsGEGNtGlmpMyqyrbqsEUvQsWKJUyaNWqaJIw9SCIRsGnWQtVY29YqVhQqcPB4QeRRM2vASOwlqCbZXWWtghQqfKyYqjYynDSC9YsXrEZDlvSyZivC5Et7plGLNeaFCxSw2g5TRcYFlU5UC+dac8NXNUgBCgaaNs2QjDWoEAkJfqwUFxddSg3jzHbYmSjSokn/HniEWTVDOj4VO1YIyvZjt2qEQfWeO1taOEJZSzQWUrVYKpTClh1cGFMVLCy8UthVfGxiYFt5eEHNLgSMNAEz00xhR1tprMGWKi/QwlYxrLQBgxEqrJFLW6PcAM0zrl0iBjXCvMAKW8ZwkQdboNDAyzG7kQEDFVOx0kQQo7D1SgvLRCMSbNaYMgR1wzixWVWVAMHLKFyYwAMo9QWTBwp2/HIMiE1WMBIh1jxCxXpVBSOEJGwhEgMVLJzhhwpnrNhWKUU0oUolQUjDDANrWoOJE/XxYsMnbPGhQhusrPdKFTqA8mBVvLyhghBwVJNKcrD9Z8MtbN0iQyFwvlEGnHFS/xECHWbi6IgKj1gjCwIj/RDNMzdUgmMjL5BxizFh0LEgF1oYgQQqbRWDyA3IUGNFTa6c18SPbMEiBQ+ZSAFIYcMwUcgvdKDgB3XBSPFHNaLUpMY0zxRxBnVACpKCCIsUJiedx4DCwxmbSsKDoYheUkEy1GwhQhcitqVKE0UIWNUvkrTQCVt5aLHpKy8gM814R0ijjAySaFFDJZseE4wdKORByyJGuCACtFW1QXCqMvRCzQ4jqWEqL8MUokIcflolyQgq8OBHJwlaFcaGbM3ygjDUjLdHNaZMVxUrUyBp4Cx+4CBEIaiq4kLEw0AhSFugzAANNDG6UU0rONTqMh8oyP+RRw1NLMJtwDVwG8wQjoy4BhrV2DKAQFnQ+IKCbaHShBOV6I0lEMH9gsMmH7ZA1Bw1WYDhFHy07DK+nL7BxHu3wIAzK0PgUU0yag6kSZQ1UG4ffIUIwUO/ByaIsQ5oSEONGnv98Mw0aDBBGGdk6wCEIKjyaMIZQtzwiGyELEVQItRAMwYQkuhdDCx/G7FI0la9cQMbnCyTUyAKICRKTozcIMQZfLDDFWDAhMxxZxYxWIVHpuEKJTwuIYlASTNCUYcxoIEITYgYZ3ihhTFQIxp7UMIBSJIFW9hlI9VABhHCMIuWXeUKSHhMIF5TESsEwhOpIIY1kIEpO5RiFrAYBR1LauAFZVTDFfljikFIkK1phGILM3jBC2bghVWgJBUVUGJCKAGNuzxDGMh4hkagEYgHaFEhR/AEMaLBHGjsghA7OKNNdmAFJfxAiwEBACH5BAkOAJcALAAAAQAoACcAAAj/AC8JHEiwYMEdc/bsUXPEoMOHBiFAGLjHVrRq1qxVkybLTQOIIAWKgWQrGTNgooBVq/aslilTtZ5Vo+ZqR0iHYnZRs0ZNmrRpGJfhmVHDiJEaN/Ags5bsCICbFKFZe/ZoS5AcS/A8ukEF1K1hw25tupKjVTViHaBe2jNtGqYXTPhk6rSoyQg/w47p3RuMz4xY1jwJuGkl2rQ/PCTl1TtLR55ieyMfK2aHCDRpP56ClFUNU45SxvYWSwPll2TJvIxgspZI80M105bdaBR676YXpSKDLWas9zFjgKJMc2YFAURK1jA1CRY5lxE7tY0VMpJEipYuZdbQCdNCWLVpnio8/+TsJU9kY3aE3NqrKoYdRIP42JGTJgwVGzf+PLNmy4JDYtMQUUlkqMCwCV9XhLHYecXkkgkTSAhjTSoHFORAMtLwkMlev0hxxoKL1PDKaaidEUQz1ajh2iViREPNE4WwV4Iqe82CQ4wkShYMFWxMQ8wCA/3ATDWhoNAFZMcMIwUdeg1Thglv+CEIIo1UsgkopbxSm16oyOBLNVZoloo1q8jwBgoj6jWKCrAcs4kLYYShBRQmyAAEDjTAcEJuolHBCGtPWTHNMzz4UUwXZ0SnxRq3CGEHb8ZQxgQvv/ByyxtSLHhMHmNU40oAl2iSnBG8HKMKCjRyiQIXRuQSGS0vbP/ImAqfRIZIFNTYMhgw1FThx15ndBFdGCUcKJkfRjCnVx5NLOiHF9TIEgAJz0RzAyh7vYICKnuxYgK35w2igSR73SLDgL918Yc1mgBAAjTNyJCqXm9QgeQxZ2ix5TGw1OAEEMoeAwgSzMEiQyzViAEACM9Ac8Mokc2iQifBgKUtaE3aRwsPi+zFSw6NDJMGFsNN8BSvUeC4lx0vAGEEE1KoEMQZbdCxRgw0LpJDqXohEkQeM3wZiJjWPNKEaR5vUkkjiAgi3xtnSMFBHqEFU8Qg5dLwQivW7AKBZllQswwPheyb4zBvNMHzMYjwgHQxWqzLDAkrplKNKTJIcm+Opbj/UKtevzjx4V50sFGNKCteYsUz1GAigxywaBoZL0m0ce8gOswSmRxwVONJ4ixeFEsUMVDxRh5+DIKII1bS0QMt3cbQSGTFXPFnazgl8x0mJoTRxRVQMDFEDzzYQK5ewXDBRcDHzBIDwlmALtAOlFCjzAyoRFrMMMEEU2lkjcTAynl2PCGNMxJIL5ADvG4hx96n2SjIlsZU8gJgkKg/UCLVxBIDtjkKRhmcgLQkLeIGj6hGMiygP4EIiRqIyd5pgvEGDqShFKxARSGcMANOUCMaYYIKbKahhxjkIXKRysUopMCDP0RhBi+YwRMY0QxrOCMLoFILJKhBjVU8wQVN0AIVWXTwAv3wBBrLeMY0eCKLHTTQIXvYzzR8wQlGPGIVKKqGLXZRrWcQQxNWIMATH6IETTgDIxmxhjR2IQYDHKACIJiAAgIwxpDsQAyBIEQg1EACMarlj4CESkAAADs=`)
var llmLabelWidth = 60

type tool struct {
	Name    string `json:"name"`
	Command string `json:"command"`
	Prompt  string `json:"prompt"`
}

func init() {
	plugin.AllSystemPlugin = append(plugin.AllSystemPlugin, &Plugin{})
}

type Plugin struct {
	api      plugin.API
	provider Provider
	model    model
}

func (c *Plugin) GetMetadata() plugin.Metadata {
	return plugin.Metadata{
		Id:            "c9910664-1c28-47ae-bad6-e7332a02d471",
		Name:          "LLM tools",
		Author:        "Wox Launcher",
		Website:       "https://github.com/Wox-launcher/Wox",
		Version:       "1.0.0",
		MinWoxVersion: "2.0.0",
		Runtime:       "Go",
		Description:   "LLM tools for Wox",
		Icon:          llmIcon.String(),
		Entry:         "",
		TriggerKeywords: []string{
			"llm",
		},
		SupportedOS: []string{
			"Windows",
			"Macos",
			"Linux",
		},
		SettingDefinitions: definition.PluginSettingDefinitions{
			{
				Type: definition.PluginSettingDefinitionTypeSelect,
				Value: &definition.PluginSettingValueSelect{
					Key:          "provider",
					Label:        "Provider",
					Tooltip:      "The LLM service provider",
					DefaultValue: string(modelProviderNameOpenAI),
					Options: []definition.PluginSettingValueSelectOption{
						{
							Label: "OpenAI",
							Value: string(modelProviderNameOpenAI),
						},
						{
							Label: "Google",
							Value: string(modelProviderNameGoogle),
						},
						{
							Label: "Ollama",
							Value: string(modelProviderNameOllama),
						},
						{
							Label: "Groq",
							Value: string(modelProviderNameGroq),
						},
					},
					Style: definition.PluginSettingValueStyle{
						LabelWidth: llmLabelWidth,
					},
				},
			},
			{
				Type:  definition.PluginSettingDefinitionTypeNewLine,
				Value: &definition.PluginSettingValueNewLine{},
			},
			{
				Type: definition.PluginSettingDefinitionTypeDynamic,
				Value: &definition.PluginSettingValueDynamic{
					Key: "dynamic_models",
				},
			},
			{
				Type:  definition.PluginSettingDefinitionTypeNewLine,
				Value: &definition.PluginSettingValueNewLine{},
			},
			{
				Type: definition.PluginSettingDefinitionTypeDynamic,
				Value: &definition.PluginSettingValueDynamic{
					Key: "dynamic_host",
				},
			},
			{
				Type: definition.PluginSettingDefinitionTypeDynamic,
				Value: &definition.PluginSettingValueDynamic{
					Key: "dynamic_api_key",
				},
			},
			{
				Type: definition.PluginSettingDefinitionTypeTable,
				Value: &definition.PluginSettingValueTable{
					Key:     "tools",
					Title:   "Tools",
					Tooltip: "The tools to run the llm tool.\r\nE.g. `translate`, user will type `llm translate` to run translate based on the prompt",
					Columns: []definition.PluginSettingValueTableColumn{
						{
							Key:     "name",
							Label:   "Name",
							Type:    definition.PluginSettingValueTableColumnTypeText,
							Width:   100,
							Tooltip: "The name of the llm tool",
						},
						{
							Key:     "command",
							Label:   "Command",
							Type:    definition.PluginSettingValueTableColumnTypeText,
							Width:   100,
							Tooltip: "The command to run the llm tool. E.g. `translate`, user will type `gpt translate` to run this tool",
						},
						{
							Key:          "prompt",
							Label:        "Prompt",
							Type:         definition.PluginSettingValueTableColumnTypeText,
							TextMaxLines: 10,
							Tooltip:      "The prompt to send to the llm tool. %s will be replaced with the user input",
						},
					},
				},
			},
		},
		Features: []plugin.MetadataFeature{
			{
				Name: plugin.MetadataFeatureIgnoreAutoScore,
			},
			{
				Name: plugin.MetadataFeatureQuerySelection,
			},
		},
	}
}

func (c *Plugin) Init(ctx context.Context, initParams plugin.InitParams) {
	c.api = initParams.API
	c.api.OnGetDynamicSetting(ctx, func(key string) definition.PluginSettingDefinitionItem {
		return c.getDynamicSetting(ctx, key)
	})
	c.api.OnSettingChanged(ctx, func(key string, value string) {
		if key == "tools" {
			c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("tools setting changed: %s", value))
			var commands []plugin.MetadataCommand
			gjson.Parse(value).ForEach(func(_, command gjson.Result) bool {
				commands = append(commands, plugin.MetadataCommand{
					Command:     command.Get("command").String(),
					Description: command.Get("name").String(),
				})

				return true
			})
			c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("registering query commands: %v", commands))
			c.api.RegisterQueryCommands(ctx, commands)
		}
		if key == "provider" || strings.HasPrefix(key, "model_") || strings.HasPrefix(key, "host_") || strings.HasPrefix(key, "api_key_") {
			c.loadClient(ctx)
		}
	})

	c.loadClient(ctx)
}

func (c *Plugin) Query(ctx context.Context, query plugin.Query) []plugin.QueryResult {
	if query.Type == plugin.QueryTypeSelection {
		if c.provider == nil || query.Selection.Type == util.SelectionTypeFile {
			return []plugin.QueryResult{}
		}

		tools, toolsErr := c.getAllTools(ctx)
		if toolsErr != nil {
			return []plugin.QueryResult{}
		}

		var results []plugin.QueryResult
		for _, t := range tools {
			results = append(results, plugin.QueryResult{
				Title:    t.Command,
				SubTitle: t.Name,
				Icon:     llmIcon,
				Actions: []plugin.QueryResultAction{
					{
						Name:                   "Run",
						PreventHideAfterAction: true,
						Action: func(ctx context.Context, actionContext plugin.ActionContext) {
							c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("run tool: %s", t.Command))
							c.api.ChangeQuery(ctx, share.ChangedQuery{
								QueryType: plugin.QueryTypeInput,
								QueryText: fmt.Sprintf("%s %s %s", c.GetMetadata().TriggerKeywords[0], t.Command, query.Selection.Text),
							})
						},
					},
				},
			})
		}
		return results
	}

	if c.provider == nil {
		return []plugin.QueryResult{
			{
				Title:    "Provider not initialized",
				SubTitle: "Please complete the settings",
				Icon:     llmIcon,
			},
		}
	}

	if query.Command == "" {
		return c.listAllTools(ctx, query)
	}

	return c.queryCommand(ctx, query)
}

func (c *Plugin) getDynamicSetting(ctx context.Context, key string) definition.PluginSettingDefinitionItem {
	if key == "dynamic_models" {
		var provider = c.api.GetSetting(ctx, "provider")
		if provider == "" {
			return definition.PluginSettingDefinitionItem{}
		}

		var options []definition.PluginSettingValueSelectOption
		for _, m := range c.getProviderModels(ctx, modelProviderName(provider)) {
			options = append(options, definition.PluginSettingValueSelectOption{
				Label: m.DisplayName,
				Value: m.Name,
			})
		}

		return definition.PluginSettingDefinitionItem{
			Type: definition.PluginSettingDefinitionTypeSelect,
			Value: &definition.PluginSettingValueSelect{
				Key:     "model_" + provider, // different model for different provider
				Label:   "Model",
				Tooltip: "The LLM provided by the provider you selected",
				Options: options,
				Style: definition.PluginSettingValueStyle{
					LabelWidth: llmLabelWidth,
				},
			},
		}
	}

	if key == "dynamic_host" {
		if c.api.GetSetting(ctx, "provider") == string(modelProviderNameOllama) {
			return definition.PluginSettingDefinitionItem{
				Type: definition.PluginSettingDefinitionTypeTextBox,
				Value: &definition.PluginSettingValueTextBox{
					Key:          "host_" + string(modelProviderNameOllama),
					Label:        "Host",
					Tooltip:      "The Ollama host",
					DefaultValue: "http://localhost:11434",
					Style: definition.PluginSettingValueStyle{
						Width:      300,
						LabelWidth: llmLabelWidth,
					},
				},
			}
		}
	}

	if key == "dynamic_api_key" {
		if c.api.GetSetting(ctx, "provider") != string(modelProviderNameOllama) {
			return definition.PluginSettingDefinitionItem{
				Type: definition.PluginSettingDefinitionTypeTextBox,
				Value: &definition.PluginSettingValueTextBox{
					Key:     "api_key_" + c.api.GetSetting(ctx, "provider"), // different api key for different provider
					Label:   "API Key",
					Tooltip: "The API key for the provider you selected. Please refer to the provider's documentation to get the API key",
					Style: definition.PluginSettingValueStyle{
						Width:      500,
						LabelWidth: llmLabelWidth,
					},
				},
			}
		}
	}

	return definition.PluginSettingDefinitionItem{}
}

func (c *Plugin) getProviderModels(ctx context.Context, providerName modelProviderName) (models []model) {
	if provider, providerErr := NewProvider(ctx, providerConnectContext{
		Provider: providerName,
		api:      c.api,
		ApiKey:   c.api.GetSetting(ctx, string("api_key_"+providerName)),
		Host:     c.api.GetSetting(ctx, string("host_"+providerName)),
	}); providerErr == nil {
		if providerModels, modelsErr := provider.Models(ctx); modelsErr == nil {
			models = append(models, providerModels...)
		} else {
			c.api.Log(ctx, plugin.LogLevelError, fmt.Sprintf("failed to get models from providerName: %s", modelsErr.Error()))
		}
	} else {
		c.api.Log(ctx, plugin.LogLevelError, fmt.Sprintf("failed to create llm providerName: %s", providerErr.Error()))
	}

	return
}

func (c *Plugin) loadClient(ctx context.Context) {
	providerName := c.api.GetSetting(ctx, "provider")
	if providerName == "" {
		c.api.Log(ctx, plugin.LogLevelWarning, "provider is empty")
		return
	}
	modelName := c.api.GetSetting(ctx, "model_"+providerName)
	if modelName == "" {
		c.api.Log(ctx, plugin.LogLevelWarning, "model is empty")
		return
	}

	provider, providerErr := NewProvider(ctx, providerConnectContext{
		Provider: modelProviderName(providerName),
		api:      c.api,
		ApiKey:   c.api.GetSetting(ctx, "api_key_"+providerName),
		Host:     c.api.GetSetting(ctx, "host_"+providerName),
	})
	if providerErr != nil {
		c.api.Log(ctx, plugin.LogLevelError, fmt.Sprintf("failed to create llm provider: %s", providerErr.Error()))
		return
	}

	//close previous provider
	if c.provider != nil {
		closeErr := c.provider.Close(ctx)
		if closeErr != nil {
			c.api.Log(ctx, plugin.LogLevelError, fmt.Sprintf("failed to close llm provider: %s", closeErr.Error()))
		} else {
			c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("llm provider closed, model: %s", c.model.Name))
		}
	}

	models := c.getProviderModels(ctx, modelProviderName(providerName))
	var availableModel model
	for _, m := range models {
		if m.Name == modelName {
			availableModel = m
			break
		}
	}
	c.model = availableModel
	c.provider = provider
	c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("llm provider created with model: %s", modelName))
}

func (c *Plugin) listAllTools(ctx context.Context, query plugin.Query) []plugin.QueryResult {
	tools, toolsErr := c.getAllTools(ctx)
	if toolsErr != nil {
		return []plugin.QueryResult{
			{
				Title:    "Failed to get tools",
				SubTitle: toolsErr.Error(),
				Icon:     llmIcon,
			},
		}
	}
	if len(tools) == 0 {
		return []plugin.QueryResult{
			{
				Title: "No tools found",
				Icon:  llmIcon,
			},
		}
	}

	var results []plugin.QueryResult
	for _, t := range tools {
		results = append(results, plugin.QueryResult{
			Title:    t.Command,
			SubTitle: t.Name,
			Icon:     llmIcon,
			Actions: []plugin.QueryResultAction{
				{
					Name:                   "Run",
					PreventHideAfterAction: true,
					Action: func(ctx context.Context, actionContext plugin.ActionContext) {
						c.api.ChangeQuery(ctx, share.ChangedQuery{
							QueryType: plugin.QueryTypeInput,
							QueryText: fmt.Sprintf("%s %s ", query.TriggerKeyword, t.Command),
						})
					},
				},
			},
		})
	}
	return results
}

func (c *Plugin) getAllTools(ctx context.Context) (tools []tool, err error) {
	toolsSettings := c.api.GetSetting(ctx, "tools")
	if toolsSettings == "" {
		return nil, nil
	}

	err = json.Unmarshal([]byte(toolsSettings), &tools)
	return
}

func (c *Plugin) queryCommand(ctx context.Context, query plugin.Query) []plugin.QueryResult {
	if query.Search == "" {
		return []plugin.QueryResult{
			{
				Title: "Please input something",
				Icon:  llmIcon,
			},
		}
	}

	tools, toolsErr := c.getAllTools(ctx)
	if toolsErr != nil {
		return []plugin.QueryResult{
			{
				Title:    "Failed to get tools",
				SubTitle: toolsErr.Error(),
				Icon:     llmIcon,
			},
		}
	}
	if len(tools) == 0 {
		return []plugin.QueryResult{
			{
				Title: "No tools found",
				Icon:  llmIcon,
			},
		}
	}

	queryTool, toolExist := lo.Find(tools, func(tool tool) bool {
		return tool.Command == query.Command
	})
	if !toolExist {
		return []plugin.QueryResult{
			{
				Title: "No tool found",
				Icon:  llmIcon,
			},
		}
	}
	if queryTool.Prompt == "" {
		return []plugin.QueryResult{
			{
				Title: "Prompt is empty for this command",
				Icon:  llmIcon,
			},
		}
	}

	var prompts = strings.Split(queryTool.Prompt, "|")
	var conversations []Conversation
	for index, message := range prompts {
		msg := fmt.Sprintf(message, query.Search)
		if index%2 == 0 {
			conversations = append(conversations, Conversation{
				Role: ConversationRoleUser,
				Text: msg,
			})
		} else {
			conversations = append(conversations, Conversation{
				Role: ConversationRoleSystem,
				Text: msg,
			})
		}
	}

	onAnswering := func(current plugin.RefreshableResult, deltaAnswer string) plugin.RefreshableResult {
		current.Icon = llmLoadingIcon
		current.Preview.PreviewData += deltaAnswer
		current.Preview.ScrollPosition = plugin.WoxPreviewScrollPositionBottom
		return current
	}
	onAnswerErr := func(current plugin.RefreshableResult, err error) plugin.RefreshableResult {
		current.Icon = llmIcon
		current.Preview.PreviewData += fmt.Sprintf("\n\nError: %s", err.Error())
		current.RefreshInterval = 0 // stop refreshing
		return current
	}
	onAnswerFinished := func(current plugin.RefreshableResult) plugin.RefreshableResult {
		current.Icon = llmIcon
		current.RefreshInterval = 0 // stop refreshing
		return current
	}

	return []plugin.QueryResult{{
		Title:           fmt.Sprintf("Chat with %s", query.Command),
		SubTitle:        fmt.Sprintf("%s - %s", c.model.Provider, c.model.DisplayName),
		Preview:         plugin.WoxPreview{PreviewType: plugin.WoxPreviewTypeMarkdown, PreviewData: ""},
		Icon:            llmLoadingIcon,
		RefreshInterval: 100,
		OnRefresh:       c.generateGptResultRefresh(ctx, conversations, onAnswering, onAnswerErr, onAnswerFinished),
	}}
}

// generate a result which will send chat messages to openai and show the result automatically
func (c *Plugin) generateGptResultRefresh(ctx context.Context, conversations []Conversation,
	onAnswering func(plugin.RefreshableResult, string) plugin.RefreshableResult,
	onAnswerErr func(plugin.RefreshableResult, error) plugin.RefreshableResult,
	onAnswerFinished func(plugin.RefreshableResult) plugin.RefreshableResult) func(ctx context.Context, current plugin.RefreshableResult) plugin.RefreshableResult {

	var stream ProviderChatStream
	var creatingStream bool
	return func(ctx context.Context, current plugin.RefreshableResult) plugin.RefreshableResult {
		if stream == nil {
			if creatingStream {
				c.api.Log(ctx, plugin.LogLevelInfo, "Already creating stream, waiting create finish")
				return current
			}

			startTime := util.GetSystemTimestamp()
			c.api.Log(ctx, plugin.LogLevelInfo, "creating stream")
			creatingStream = true
			createdStream, createErr := c.provider.ChatStream(ctx, c.model, conversations)
			creatingStream = false
			c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("created stream (cost %d ms)", util.GetSystemTimestamp()-startTime))
			if createErr != nil {
				if onAnswerErr != nil {
					current = onAnswerErr(current, createErr)
				}
				current.RefreshInterval = 0 // stop refreshing
				return current
			}
			stream = createdStream
		}

		c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("reading stream, model=%s", c.model.Name))
		response, streamErr := stream.Receive(ctx)
		if errors.Is(streamErr, io.EOF) {
			c.api.Log(ctx, plugin.LogLevelInfo, "read stream completed")
			stream.Close(ctx)
			if onAnswerFinished != nil {
				current = onAnswerFinished(current)
			}
			current.RefreshInterval = 0 // stop refreshing
			return current
		}

		if streamErr != nil {
			c.api.Log(ctx, plugin.LogLevelError, fmt.Sprintf("failed to read stream: %s", streamErr.Error()))
			stream.Close(ctx)
			if onAnswerErr != nil {
				current = onAnswerErr(current, streamErr)
			}
			current.RefreshInterval = 0 // stop refreshing
			return current
		}

		if onAnswering != nil {
			c.api.Log(ctx, plugin.LogLevelInfo, fmt.Sprintf("streamed %d text", len(response)))
			current = onAnswering(current, response)
		}

		return current
	}
}
